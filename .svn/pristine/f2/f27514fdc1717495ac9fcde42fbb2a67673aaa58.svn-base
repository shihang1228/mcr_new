<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1, user-scalable=no">
<title>智能找货</title>
<meta name="description" content="">
<meta name="keywords" content="">
<link rel="stylesheet" type="text/css" href="/statics/css/yumleeM.css" />
<link rel="stylesheet" type="text/css" href="/statics/css/mcr.css" />
<link rel="stylesheet" type="text/css" href="/com/icomoon/style.css" />
</head>
<body class="bgWhite">
<header class="header">
	<div><a href="javascript:history.back();"><i class="icon-arrow-back"></i></a></div>
	<h1>智能找货</h1>
	<div><a href="index.php"><i class="icon-home"></i></a></div>
</header>
<?php
    include_once('mcr_sc_fns.php');
	session_start();
	
	//$portnum=0;
    //$port_array = get_port($portnum);
	$stuffnum=0;
	$stuff_array=get_stuff($stuffnum);
	//
	if  (isset($_POST['submit']))
    {
      //$inputnumber=$_POST["numberInput"];
	  $portid=$_SESSION['portid'];
	  $kindid=$_POST["kindselect"];
	  $stuffid=$_POST["stuffselect"];
	  $productlen=$_POST["productlen"];
	  $wide=$_POST["wide"];
	  $thinckness=$_POST["thinckness"];
	  $diameterlen=$_POST["diameterlen"];
	  $timber=$_POST["timber"];
	  $publishtime=$_POST["publishtime"];
	  $data_array=get_datafromadvance($portid,$kindid,$stuffid,$productlen,
      $wide,$thinckness,$diameterlen,$timber,$publishtime);
	  
?>
   <dl class="panel">
	<dt><h2>智能找货</h2></dt>
    <dd id="goodslist" class="borTop">
	 <?php
	     $outstr=" ";
	    if (!is_array($data_array)) {
           echo "<p>对不起，没有查找到您要查找的内容！</p>";
           return;
        }
		else {
		    foreach ($data_array as $row)
            {
			   $carnum = $row['carnum'];
			   $productlen = $row['productlen'];
			   if($productlen == 0){
				$productlen = "";
			   }else{
				$productlen = $productlen;
			   }
			   $kindname=$row['kindname'];
			   $wide=$row['wide'];
			   $thinckness=$row['thinckness']; 
			   $widerange=$row['widerange'];
			   $thincknessrange=$row['thincknessrange'];
		       $timber=$row['timber'];
			   $diameterlen=$row['diameterlen'];
			   $dumpposition=$row['dumpposition'];
			   $stuffname=$row['stuffname'];
			   $cdkey=$row['cdkey'];
			   $outstr="";
			   if($kindname =="原木"){
			     if (($diameterlen ==0) or($timber ==0)){
				   $outstr="<li>".$kindname."</li>";
				 }
				 else {
				    $outstr="<li>".$diameterlen."φ &nbsp;&nbsp;".$timber."</li>";
				 }
			   }
			   else {
			       if($wide ==0 or $thinckness ==0) {
				     $outstr="<li>".$kindname."</li>";
				   }
				   else {
				      $outstr="<li>".$thinckness."*".$wide."</li>";
					  if (($kindname=="大方") or ($kindname=="大板"))
					  {
						  if(($widerange !=0) or($thincknessrange !=0))
						  {
							   $outstr="<li>".$thinckness."*".$wide."起</li>";
						  }
					  }
				   }
			   }
			 if($row['goodtype'] ==1){
				 $dumpposition=$row['goodposition'];
			 }
			 else {
				 $carnum=$row['refcapacity'];
			 }
			 if($dumpposition=='0')
			 {
				 $dumpposition="";
			 } 

	 ?>

		<a href="<?php echo $row['goodtype']==1?'detail.php?cdkey='.$cdkey :'dumpdetail.php?cdkey='.$cdkey;?>">
			<ul class="flex table table_list stable5">
				<li><?php echo  $carnum;?></li><li><?php echo $productlen;?></li><li><?php echo $stuffname;?></li><?php echo $outstr;?><li class="ellipsis"><?php echo $dumpposition;?></li>
			</ul>
		</a>
    <?php
	     }
      }
    ?>
	 </dd>


    </dl>
 <?php
	} 
	else {
?>
<form action="" method="post" class="addForm">
	<dl class="panel boxShadowNone">
		<dt></dt>
		<dd>
			<ul class="list">
				<li class="flex col1-3">
					<div>货种:</div><div>
					<select id="kindselect" name ="kindselect" class="selectItem">
						<option value = 0>选货种</option>
						<option value = 1>原木</option>
						<option value = 2>条子</option>
						<option value = 3>口料</option>
						<option value = 4>大方</option>
						<option value = 5>大板</option>
						<option value = 6>防腐材</option>
					</select></div>
				</li>
				<li class="flex col1-3">
					<div>树种:</div><div>
					<select name ="stuffselect" id="stuffselect" class="selectItem">
						<option value = "0">选树种</option>
					    <?php
		                   for($i=0;$i<$stuffnum;$i++) {
								$row =$stuff_array->fetch_assoc();
								$stuffid = $row['stuffid'];
		                        $stuffname = $row['stuffname'];
		                        echo "<option value =".$stuffid.">".$stuffname."</option>";
							}
		                    ?>
					</select></div>
				</li>
				<li class="flex col1-3">
					<div>长度:</div>
					<div>
						<select id="productlen" name="productlen" class="selectItem">
							<option value="0">选长度</option>
							<option value="2">2米</option>
							<option value="2.5">2.5米</option>
							<option value="3">3米</option>
							<option value="4">4米</option>
							<option value="6">6米</option>
							<option value="12">12米</option>
							<option value="8">8米</option>
						</select>
					</div>
				</li>
				<li class="flex op-2 hide col1-3" id="kindselect_1">
					<div>宽度:</div>
					<div><input type="tel" name="wide" id="wide" class="selectItem"/></div>
				</li>
				<li class="flex op-2 hide col1-3" id="kindselect_2">
					<div>厚度:</div>
					<div><input type="tel" name="thinckness" id="thinckness" class="selectItem"/></div>
				</li>
				<li class="flex op-1 hide col1-3" id="kindselect_3">
					<div>径级:</div>
					<div><input type="tel" name="diameterlen" id="diameterlen" class="selectItem"/></div>
				</li>
				<li class="flex op-1 hide col1-3" id="kindselect_4">
					<div>材质:</div><div>
					<select class="selectItem" id="timber" name="timber">
						<option value="0">选材质</option>
						<option value="选材">选材</option>
						<option value="一级材">一级材</option>
						<option value="二级材">二级材</option>
						<option value="加工材">加工材</option>
					</select></div>
				</li>
				<li class="flex col1-3">
					<div>发布时间:</div><div>
					<select class="selectItem" name="publishtime" id="publishtime">
						<option value="0">选时间</option>
						<option value="1">1天以内</option>
						<option value="3">3天以内</option>
						<option value="5">5天以内</option>
						<option value="7">7天以内</option>
						<option value="30">30天以内</option>
					</select></div>
				</li>
			</ul>
		</dd>
	</dl>
	<input class="btnFixed" type="submit" name ="submit" value="查找" />
</form>
<?php
	}
?>

</body>
<script src="http://libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/statics/js/config.js"></script>
<script type="text/javascript">
$(function(){
	kindselect();
	$("#kindselect").change(function (){
		kindselect();
	})
})

</script>
</html>