/*
 *  Javascript文件：waterfall.js
 */
$(function(){
    jsonajax();
 });
 
 //这里就要进行计算滚动条当前所在的位置了。如果滚动条离最底部还有100px的时候就要进行调用ajax加载数据
 $(window).scroll(function(){    
     //此方法是在滚动条滚动时发生的函数
     // 当滚动到最底部以上100像素时，加载新内容
     var $doc_height,$s_top,$now_height;
     $doc_height = $(document).height();        //这里是document的整个高度
     $s_top = $(this).scrollTop();            //当前滚动条离最顶上多少高度
     $now_height = $(this).height();            //这里的this 也是就是window对象
     if(($doc_height - $s_top - $now_height) < 100) jsonajax();    
 });
 
 
 //做一个ajax方法来请求data.php不断的获取数据
 var $num = -1;
 var $pagecount = 0;

function start(type,page){	
	$num = 0;
	$pagecount = 0;
	var search =$("#numberInput").val();
	 if(search.length == 0){
		search = 0;
	 }
	if($pagecount >= $num){

		 $.ajax({
			 url:'usermanage_bgo.php',
			 type:'POST',
			 data:"num="+($num=($num++))+"&search="+search,

			 dataType:'json',
			 success:function(json){
				 if(typeof json == 'object'){

					 var neirou,$row,$item;
					 $row =$("#ul_list").empty();
					 if(json.length == 0){
						 
						$("#ul_list").empty().append("<p class='no_result'>没有查询到您所要的内容</p>");
					 }else{
						 
						$pagecount = json[0].pagecount;
						for(var i=1;i<json.length;i++){
							neirou = json[i];    //当前层数据
							$item = $(
							"<li>"+
								"<b class='select_btn'><img src='../images/img_2.png' alt='' width='40' height='40'/></b>"+
								"<a href='userdetail.php?userid="+neirou.userid+"' class='li_link'>"+
									"<h3>"+
										"<span>"+neirou.username+"</span>"+
										"<span>"+neirou.phone+"</span>"+
										"<span>"+neirou.rightid+"</span>"+
									"</h3>"+
									"<p>"+
										"<span>"+neirou.freeze+"</span><span>登录次数："+neirou.loginnum+"</span><span>"+neirou.logintime+"</span>"+
									"</p>"+
								"</a>"+
								"<div class='tip'>"+
									"<div class='triangle'></div>"+
									"<div class='t_con'>"+
										"<input type='hidden' name='mes_id' id='mes_id' value='"+neirou.userid+"' />"+
										"<a href='#' class='del' class='del'><i class='icon-lock-closed'></i><br /><span>冻结</span></a>"+
										"<a href='#'><i class='icon-lock-open'></i><br /><span>解冻</span></a>"+
										"<a href='#'><i class='icon-bin'></i><br /><span>删除</span></a>"+
									"</div>"+
								"</div>"+
							"</li>"
							);
							 $(".no_result").empty();
							 $row.append($item);
							 $item.fadeIn();
						}
					 }
				}
			 }
		 });
	}
}


 function jsonajax(){
	 var search =$("#numberInput").val();
	 if(search.length == 0){
		search = 0;
	 }

	if($pagecount > $num){
		 $.ajax({
			 url:'usermanage_bgo.php',
			 type:'POST',
			 data:"num="+($num=($num+1))+"&search="+search,

			 dataType:'json',
			 success:function(json){
				 if(typeof json == 'object'){
					 var neirou,$row,$item;
					 
					 $pagecount = json[0].pagecount;
					 for(var i=1;i<json.length;i++){
							neirou = json[i];    //当前层数据

							 $row =$("#ul_list");
							$item = $(
							"<li>"+
								"<b class='select_btn'><img src='../images/img_2.png' alt='' width='40' height='40'/></b>"+
								"<a href='userdetail.php?userid="+neirou.userid+"' class='li_link'>"+
									"<h3>"+
										"<span>"+neirou.username+"</span>"+
										"<span>"+neirou.phone+"</span>"+
										"<span>"+neirou.rightid+"</span>"+
									"</h3>"+
									"<p>"+
										"<span>"+neirou.freeze+"</span><span>登录次数："+neirou.loginnum+"</span><span>"+neirou.logintime+"</span>"+
									"</p>"+
								"</a>"+
								"<div class='tip'>"+
									"<div class='triangle'></div>"+
									"<div class='t_con'>"+
										"<input type='hidden' name='mes_id' id='mes_id' value='"+neirou.userid+"' />"+
										"<a href='#' class='lock' id='lock'><i class='icon-lock-closed'></i><br /><span>冻结</span></a>"+
										"<a href='#' class='open' id='open'><i class='icon-lock-open'></i><br /><span>解冻</span></a>"+
										"<a href='#' class='del' id='del'><i class='icon-bin'></i><br /><span>删除</span></a>"+
									"</div>"+
								"</div>"+
							"</li>"
							);
							 $(".no_result").empty();
							 
							 $row.append($item);
							 $item.fadeIn();
					}

				}
			 }
		 });
	}
 }